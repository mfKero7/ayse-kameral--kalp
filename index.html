<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>AyÅŸe'nin Kalp AvÄ± 2025 ğŸ’</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; touch-action: none; }
        canvas { display: block; width: 100vw; height: 100vh; object-fit: cover; transition: filter 0.5s; }
        .blurred { filter: blur(15px) brightness(0.5); }
        #ui-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        #score-box { position: absolute; top: 30px; width: 100%; text-align: center; color: #ff4757; font-size: 50px; font-weight: 900; text-shadow: 2px 2px 0 #fff; display: none; }
        #start-screen {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95); padding: 30px; border-radius: 25px;
            text-align: center; box-shadow: 0 0 30px rgba(255, 71, 87, 0.5);
            width: 90%; max-width: 480px; z-index: 100; pointer-events: auto;
        }
        #start-screen h1 { color: #ff4757; margin-bottom: 20px; }
        #start-screen ul { text-align: left; margin-bottom: 30px; color: #333; line-height: 1.8; font-size: 17px; }
        #start-btn { 
            background: #ff4757; color: white; border: none; padding: 15px 40px; 
            font-size: 20px; font-weight: bold; border-radius: 50px; cursor: pointer;
        }
        #countdown { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 150px; font-weight: 900; display: none; z-index: 200; text-shadow: 0 0 30px #ff4757; }
        #milestone-message { position: absolute; top: 40%; width: 100%; text-align: center; font-size: 55px; color: gold; font-weight: bold; text-shadow: 0 0 20px #000; opacity: 0; transition: opacity 0.4s; z-index: 50; }
        .floating-text { position: absolute; color: white; font-size: 35px; font-weight: bold; animation: floatUp 0.8s forwards; text-shadow: 0 0 5px red; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }
    </style>
</head>
<body>
    <video id="webcam" style="display:none;" autoplay playsinline></video>
    <canvas id="gameCanvas" class="blurred"></canvas>

    <div id="start-screen">
        <h1>HazÄ±r mÄ±sÄ±n AyÅŸe? â¤ï¸</h1>
        <p><b>Dikkat Edilmesi Gerekenler:</b></p>
        <ul>
            <li>ğŸ’¡ IÅŸÄ±k seviyesi iyi mi? (YeÅŸil gÃ¶zlerin belli olsun ğŸ’š)</li>
            <li>ğŸ“ Tabletten 1-2 metre uzaklaÅŸ.</li>
            <li>â˜ï¸ Ä°ÅŸaret parmaÄŸÄ±nÄ± kullanacaksÄ±n.</li>
            <li>ğŸ’ƒ Ellerini rahatÃ§a hareket ettir.</li>
        </ul>
        <button id="start-btn">OYUNA BAÅLA</button>
    </div>

    <div id="countdown"></div>
    <div id="ui-container">
        <div id="score-box">Skor: <span id="score">0</span></div>
        <div id="milestone-message"></div>
    </div>
    <audio id="popSound" src="pop.mp3" preload="auto"></audio>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

    <script>
        const videoElement = document.getElementById('webcam');
        const canvasElement = document.getElementById('gameCanvas');
        const canvasCtx = canvasElement.getContext('2d');
        const scoreElement = document.getElementById('score');
        const popSound = document.getElementById('popSound');
        const startScreen = document.getElementById('start-screen');
        const startBtn = document.getElementById('start-btn');
        const countdownElement = document.getElementById('countdown');
        const scoreBox = document.getElementById('score-box');
        const milestoneMsg = document.getElementById('milestone-message');

        let score = 0;
        let heartX = 200, heartY = 200;
        const heartSize = 100;
        let lastTouchTime = 0;
        let gameState = 'waiting';

        canvasElement.width = window.innerWidth;
        canvasElement.height = window.innerHeight;

        startBtn.onclick = () => {
            // SES KÄ°LÄ°DÄ°NÄ° AÃ‡ (Ã–nceki sorunu Ã§Ã¶zen kÄ±sÄ±m)
            if (popSound) {
                 popSound.play().then(() => { popSound.pause(); popSound.currentTime = 0; }).catch(e => console.log("Ses kilidi hatasÄ±:", e));
            }
            startScreen.style.display = 'none';
            startCountdown();
        };

        function startCountdown() {
            gameState = 'countdown';
            let count = 3;
            countdownElement.style.display = 'block';
            const timer = setInterval(() => {
                if (count > 0) { countdownElement.innerText = count; }
                else if (count === 0) { 
                    countdownElement.innerText = "BAÅLA!"; 
                    canvasElement.classList.remove('blurred');
                } else {
                    clearInterval(timer);
                    countdownElement.style.display = 'none';
                    scoreBox.style.display = 'block';
                    gameState = 'playing';
                    moveHeart();
                }
                count--;
            }, 1000);
        }

        function moveHeart() {
            heartX = 100 + Math.random() * (canvasElement.width - 200);
            heartY = 100 + Math.random() * (canvasElement.height - 200);
        }

        function showMsg(txt) {
            milestoneMsg.innerText = txt;
            milestoneMsg.style.opacity = 1;
            setTimeout(() => { milestoneMsg.style.opacity = 0; }, 2000);
        }

        function onResults(results) {
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            canvasCtx.save();
            canvasCtx.translate(canvasElement.width, 0);
            canvasCtx.scale(-1, 1);
            canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);
            canvasCtx.restore();

            if (gameState === 'playing') {
                let isHand = false;
                let fingerX = -100, fingerY = -100;
                let landmarks = null;

                if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                    isHand = true;
                    landmarks = results.multiHandLandmarks[0];
                    const lm = landmarks[8]; // Ä°ÅŸaret parmaÄŸÄ±
                    fingerX = (1 - lm.x) * canvasElement.width;
                    fingerY = lm.y * canvasElement.height;

                    if (fingerX > heartX && fingerX < heartX + heartSize && fingerY > heartY && fingerY < heartY + heartSize) {
                        const now = Date.now();
                        if (now - lastTouchTime > 400) {
                            score++;
                            scoreElement.innerText = score;
                            lastTouchTime = now;
                            try { popSound.currentTime = 0; popSound.play(); } catch(e){}
                            moveHeart();
                            if(score === 10) showMsg("SÃ¼persin AyÅŸe! ğŸ”¥");
                            if(score === 25) {
                                showMsg("AYÅE ALEV ALDI!! ğŸ”¥â¤ï¸â€ğŸ”¥");
                                document.body.style.backgroundColor = "#ff4500";
                                setTimeout(() => document.body.style.backgroundColor = "#000", 500);
                            }
                            if(score === 50) showMsg("KraliÃ§e AyÅŸe! ğŸ‘‘");
                        }
                    }
                }

                if (isHand && landmarks) {
                    // 1. Ä°ÅARET PARMAÄINA KIRMIZI LAZER Ã‡Ä°Z
                    canvasCtx.beginPath();
                    canvasCtx.fillStyle = "#FF0000"; 
                    canvasCtx.shadowColor = "#FF3333"; 
                    canvasCtx.shadowBlur = 20;
                    canvasCtx.arc(fingerX, fingerY, 12, 0, 2 * Math.PI);
                    canvasCtx.fill();
                    canvasCtx.shadowBlur = 0;

                    // 2. YÃœZÃœK PARMAÄINA ALTIN YÃœZÃœK Ã‡Ä°Z (YENÄ° EKLENTÄ° ğŸ’)
                    const ringFinger = landmarks[14]; // YÃ¼zÃ¼k parmaÄŸÄ± eklemi
                    const ringX = (1 - ringFinger.x) * canvasElement.width;
                    const ringY = ringFinger.y * canvasElement.height;

                    canvasCtx.beginPath();
                    canvasCtx.lineWidth = 6; // YÃ¼zÃ¼k kalÄ±nlÄ±ÄŸÄ±
                    canvasCtx.strokeStyle = "gold"; // AltÄ±n rengi
                    canvasCtx.shadowColor = "rgba(255, 215, 0, 0.8)"; // AltÄ±n parlamasÄ±
                    canvasCtx.shadowBlur = 10;
                    // Ä°Ã§i boÅŸ daire (halka) Ã§iziyoruz
                    canvasCtx.arc(ringX, ringY, 10, 0, 2 * Math.PI);
                    canvasCtx.stroke();
                    // AyarlarÄ± sÄ±fÄ±rla
                    canvasCtx.shadowBlur = 0;
                    canvasCtx.lineWidth = 1;
                }

                // Kalbi Ã‡iz
                canvasCtx.fillStyle = "#ff4757";
                canvasCtx.shadowColor = "red";
                canvasCtx.shadowBlur = 15;
                const hx = heartX + heartSize/2, hy = heartY + heartSize/2, s = heartSize/2;
                canvasCtx.beginPath();
                canvasCtx.moveTo(hx, hy - s * 0.6);
                canvasCtx.bezierCurveTo(hx + s * 1.2, hy - s * 1.4, hx + s * 2.4, hy + s / 3, hx, hy + s * 1.6);
                canvasCtx.bezierCurveTo(hx - s * 2.4, hy + s / 3, hx - s * 1.2, hy - s * 1.4, hx, hy - s * 0.6);
                canvasCtx.fill();
                canvasCtx.shadowBlur = 0;
            }
        }

        const hands = new Hands({locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});
        hands.setOptions({maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.5, minTrackingConfidence: 0.5});
        hands.onResults(onResults);

        const camera = new Camera(videoElement, {
            onFrame: async () => { await hands.send({image: videoElement}); },
            width: 1280, height: 720
        });
        camera.start();
    </script>
</body>
</html>
